<div class="user-form-container"> 
  <div class="set-size-and-position">
    <div class="blue-header"></div>  
    <div class="container mt-5">     
      <div class="big_card">  
        <h3 class="font-weight-light mb-0 align-middle" style="text-align:center;">Who downloaded my Content: <%= @user.name%></h3>
        <br>
        <table class="table table-striped table-hover mb-0" id="whodownloaded">
          <thead>
            <tr>
              <th class="h5 col-sm-4" style="background:none; text-align:center;">Document Name</th>
              <th class="h5 col-sm-4" style="background:none; text-align:center;">Downloaded by (email)</th>
              <th class="h5 col-sm-4" style="background:none; text-align:center;">Downloaded by (name)</th>
            </tr>
          </thead>

          <tbody>
            <% @mylogs.each do |log| %>
              <tr>
                <td class="col-sm-4" style="text-align:center;"><%= log.document.name %></td>
                <td class="col-sm-4" style="text-align:center;"><%= log.user.email %></td>
                <td class="col-sm-4" style="text-align:center;"><%= log.user.name %></td>
              </tr>
            <% end %>
          </tbody>
        </table>

        <div class="actions form-group p-3 center">
          <button class="btn button_user_card mr-2" onclick="exportData()">
            <span class="glyphicon glyphicon-download"></span>
            Export Report
          </button>   
          <%= link_to 'Back', users_path, :class => "btn button_user_card ml-2"  %>           
        </div> <%#actions form-group p-3%>
      </div> <%#big-card %>
    </div <%# container mt-5 %>>
  </div> <%# set-size-and-position %>
</div> <%# user-form-container %>

<script>
function exportData(tableID, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById("whodownloaded");
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
    
    // Specify file name
    filename = filename?filename+'.xls':'excel_data.xls';
    
    // Create download link element
    downloadLink = document.createElement("a");
    
    document.body.appendChild(downloadLink);
    
    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', tableHTML], {
            type: dataType
        });
        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    
        // Setting the file name
        downloadLink.download = filename;
        
        //triggering the function
        downloadLink.click();
    }
}
</script>
