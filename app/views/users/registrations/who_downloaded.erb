<h1 class="title mt-5 mb-5 display-3" style="text-align: center;">User's Logs</h1>
<div id="no-more-tables" class="table-responsive card mb-5">
  <div class="container container-custom rounded-3 container-bg">
  </div>
</div>
<div class="grid-container">
  <div class="container-mt5">
    <h4 class="font-weight-light mb-0 align-middle">Who downloaded my Content: <%= @user.name%></h4>
    <div class="row">
      <div class="table-responsive">
        <%# <p> %>
          <%# Download: %>
          <%# <%= link_to "CSV", user_logs_path(format: "csv"),  :class => "btn button_user_card" %> 
          <%# <%= link_to "Excel", user_logs_path(format: "xls"), :class => "btn button_user_card" %> 
        <%# </p> %>
      <br>
        <%# <button id: 'downloaded', onclick="exportData()"> %>
        <button onclick="exportData()">
          <span class="glyphicon glyphicon-download"></span>
          Export Report Who Downloaded my content
        </button>
        <%@mylogs%>
        <%@creator%>
        <% mylogs = Log.where(creator_id: @user.id)%>
        <table class="table table-striped table-hover user-table mb-0" id="whodownloaded">
        <thead>
        <div class="row">
        <tr>
            <th class="h2" style="background:none;">Creator's Email</th>
            <th class="h2" style="background:none;">Document Name</th>
            <th class="h2" style="background:none;">Document Id</th>
            <th class="h2" style="background:none;">Downloaded by (email)</th>
            <th class="h2" style="background:none;">Downloaded by (Name)</th>
            <th colspan="3"></th>
        </tr>
        </div>
        </thead>

        <tbody>
            <% @mylogs.each do |log| %>
            <div class="row">
                <tr>
                <td data-title="User Email"><%= @user.email %></td>
                <td data-title="Document Name"><%= log.document.name %></td>
                <td data-title="Document Creator Id"><%= log.creator_id %></td>
                <% creator = User.find(log.creator_id)%>
                <% creator.email%>
                <td data-title="Document Creator"><%= log.user.email %></td>
                <td data-title="User Name"><%= log.user.name %></td>
                </tr>
            </div>
            <% end %>
        </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
function exportData(tableID, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById("whodownloaded");
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
    
    // Specify file name
    filename = filename?filename+'.xls':'excel_data.xls';
    
    // Create download link element
    downloadLink = document.createElement("a");
    
    document.body.appendChild(downloadLink);
    
    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', tableHTML], {
            type: dataType
        });
        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    
        // Setting the file name
        downloadLink.download = filename;
        
        //triggering the function
        downloadLink.click();
    }
}
</script>